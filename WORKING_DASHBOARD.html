<!DOCTYPE html>
<html>
<head>
    <title>Transfer Engine Control Center</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; background:#f8f9fa; }
        .container { max-width:1200px; margin:20px auto; padding:20px; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; padding:30px 20px; border-radius:8px; margin-bottom:30px; text-align:center; }
        .header h1 { font-size:2.5em; margin-bottom:10px; font-weight:300; }
        .header p { font-size:1.2em; opacity:0.9; }
        
        .grid { display:grid; grid-template-columns: 1fr 1fr; gap:30px; margin-bottom:30px; }
        .card { background:white; border-radius:12px; padding:25px; box-shadow:0 4px 20px rgba(0,0,0,0.1); }
        .card h3 { color:#333; margin-bottom:20px; font-size:1.3em; }
        
        .form-group { margin-bottom:15px; }
        .form-group label { display:block; margin-bottom:5px; font-weight:500; color:#555; }
        .form-group select, .form-group input { width:100%; padding:12px; border:2px solid #e1e5e9; border-radius:6px; font-size:16px; }
        .form-group select:focus, .form-group input:focus { outline:none; border-color:#667eea; }
        
        .btn { padding:12px 25px; border:none; border-radius:6px; font-size:16px; cursor:pointer; font-weight:500; transition:all 0.3s; }
        .btn-primary { background:#667eea; color:white; }
        .btn-primary:hover { background:#5a6fd8; transform:translateY(-1px); }
        .btn-success { background:#28a745; color:white; }
        .btn-success:hover { background:#218838; }
        .btn-warning { background:#ffc107; color:#212529; }
        .btn-warning:hover { background:#e0a800; }
        
        .output { background:#f8f9fa; border:2px solid #dee2e6; border-radius:6px; padding:15px; margin-top:20px; font-family:monospace; min-height:200px; white-space:pre-wrap; }
        .status { padding:10px 15px; border-radius:6px; margin:10px 0; }
        .status.success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
        .status.error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }
        .status.info { background:#d1ecf1; color:#0c5460; border:1px solid #bee5eb; }
        
        .full-width { grid-column:1/-1; }
        .loading { display:none; text-align:center; padding:20px; }
        .loading.show { display:block; }
        
        @media (max-width:768px) {
            .grid { grid-template-columns: 1fr; gap:20px; }
            .container { margin:10px; padding:15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Transfer Engine Control Center</h1>
            <p>Simple, Fast, Working Stock Transfer System</p>
        </div>

        <div class="grid">
            <!-- Quick Actions -->
            <div class="card">
                <h3>üéØ Quick Actions</h3>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="testConnection()">üîå Test Connection</button>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-success" onclick="loadOutlets()">üè™ Load Outlets</button>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-warning" onclick="testSeed()">üå± Test Seed Transfer</button>
                </div>
            </div>

            <!-- Transfer Controls -->
            <div class="card">
                <h3>üì¶ Transfer Controls</h3>
                
                <div class="form-group">
                    <label>Target Store for New Seed:</label>
                    <select id="target_outlet" required>
                        <option value="">Select outlet...</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="simulate" checked> Simulation Mode (Safe Testing)
                    </label>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-primary" onclick="runSeed()">üöÄ Create New Store Seed</button>
                </div>
            </div>
        </div>

        <!-- Output Console -->
        <div class="card full-width">
            <h3>üìä System Output</h3>
            <div class="loading" id="loading">
                ‚è≥ Processing...
            </div>
            <div id="output" class="output">Ready to run transfers. Click any button above to test the system.

üìã Available Actions:
- Test Connection: Verify database connectivity
- Load Outlets: Get list of available stores  
- Test Seed: Quick test of seeding system
- Create New Store Seed: Full seed transfer for selected store

üîß System Status: Ready
</div>
        </div>
    </div>

    <script>
        const API_BASE = './cli_api.php';
        
        function showLoading(show = true) {
            document.getElementById('loading').classList.toggle('show', show);
        }
        
        function updateOutput(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = type === 'error' ? 'error' : (type === 'success' ? 'success' : 'info');
            
            output.innerHTML += `\n<div class="status ${statusClass}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function callAPI(action, params = {}) {
            showLoading(true);
            
            try {
                const queryString = new URLSearchParams({action, ...params}).toString();
                const response = await fetch(`${API_BASE}?${queryString}`);
                const result = await response.json();
                
                showLoading(false);
                
                if (result.success) {
                    updateOutput(`‚úÖ ${action.toUpperCase()}: ${result.message || 'Success'}`, 'success');
                    return result;
                } else {
                    updateOutput(`‚ùå ${action.toUpperCase()}: ${result.error}`, 'error');
                    return null;
                }
            } catch (error) {
                showLoading(false);
                updateOutput(`üí• ${action.toUpperCase()}: ${error.message}`, 'error');
                return null;
            }
        }
        
        async function testConnection() {
            updateOutput('üîå Testing database connection...');
            const result = await callAPI('test_db');
            
            if (result) {
                updateOutput(`üìä Outlet Count: ${result.outlet_count}`);
                updateOutput(`‚è∞ Timestamp: ${result.timestamp}`);
            }
        }
        
        async function loadOutlets() {
            updateOutput('üè™ Loading available outlets...');
            const result = await callAPI('get_outlets');
            
            if (result && result.outlets) {
                const select = document.getElementById('target_outlet');
                select.innerHTML = '<option value="">Select outlet...</option>';
                
                result.outlets.forEach(outlet => {
                    const option = document.createElement('option');
                    option.value = outlet.outlet_id;
                    option.textContent = outlet.outlet_name;
                    select.appendChild(option);
                });
                
                updateOutput(`‚úÖ Loaded ${result.outlets.length} outlets`, 'success');
                
                // Show first few outlets in log
                const first5 = result.outlets.slice(0, 5).map(o => o.outlet_name).join(', ');
                updateOutput(`üìã Available: ${first5}${result.outlets.length > 5 ? '...' : ''}`);
            }
        }
        
        async function testSeed() {
            updateOutput('üå± Running seed transfer test...');
            
            // Use first available outlet for test (Botany)  
            const testOutlet = '0a6f6e36-8b71-11eb-f3d6-40cea3d59c5a';
            
            const result = await callAPI('simple_seed', {
                target_outlet_id: testOutlet,
                simulate: '1',
                max_contribution: '2',
                min_stock: '3'
            });
            
            if (result) {
                updateOutput(`üì¶ Products: ${result.products_count || 0}`);
                updateOutput(`üìä Total Qty: ${result.total_quantity || 0}`);
                updateOutput(`üè™ Sources: ${result.source_stores || 0}`);
                updateOutput(`‚è±Ô∏è Time: ${result.execution_time || 0}s`);
            }
        }
        
        async function runSeed() {
            const targetOutlet = document.getElementById('target_outlet').value;
            const simulate = document.getElementById('simulate').checked;
            
            if (!targetOutlet) {
                updateOutput('‚ùå Please select a target outlet first', 'error');
                return;
            }
            
            updateOutput(`üöÄ Creating seed for outlet: ${targetOutlet}`);
            updateOutput(`üîß Mode: ${simulate ? 'SIMULATION' : 'LIVE'}`);
            
            const result = await callAPI('simple_seed', {
                target_outlet_id: targetOutlet,
                simulate: simulate ? '1' : '0',
                max_contribution: '2',
                min_stock: '5',
                respect_pack_outers: '1',
                balance_categories: '1'
            });
            
            if (result) {
                updateOutput(`‚úÖ Seed completed successfully`, 'success');
                updateOutput(`üì¶ Products seeded: ${result.products_count || 0}`);
                updateOutput(`üìä Total quantity: ${result.total_quantity || 0}`);
                updateOutput(`üè™ Source stores used: ${result.source_stores || 0}`);
                updateOutput(`‚è±Ô∏è Execution time: ${result.execution_time || 0} seconds`);
                
                if (result.neural_brain) {
                    updateOutput(`üß† Neural Brain Session: ${result.neural_brain}`);
                }
                
                if (simulate) {
                    updateOutput('‚ÑπÔ∏è This was a simulation - no actual transfers created', 'info');
                } else {
                    updateOutput('‚ö†Ô∏è LIVE MODE: Actual transfers have been created!', 'success');
                }
            }
        }
        
        // Auto-load outlets on page load
        window.addEventListener('load', () => {
            updateOutput('üåê Transfer Engine Control Center loaded');
            updateOutput('üí° Tip: Start by testing connection, then load outlets');
        });
    </script>
</body>
</html>
